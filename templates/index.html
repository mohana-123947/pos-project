<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Crisp & Chill POS | Modern Café Billing</title>
    
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <!-- Font Awesome for Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Link to External CSS -->
    <!-- Note: {{ url_for }} is Flask syntax. If running without Python, change href to "static/style.css" -->
    <link rel="stylesheet" href="static/style.css">
</head>
<body>

    <!-- Toast Notification -->
    <div id="toast">Action Successful</div>

    <!-- --- LOGIN VIEW --- -->
    <div id="login-view">
        <div class="login-card">
            <div class="login-logo"><i class="fas fa-mug-hot"></i> Crisp & Chill</div>
            <p class="login-subtitle">Point of Sale System</p>
            <form id="login-form">
                <div class="input-group">
                    <i class="fas fa-user"></i>
                    <input type="text" class="input-field" id="username" placeholder="Username (admin)" required>
                </div>
                <div class="input-group">
                    <i class="fas fa-lock"></i>
                    <input type="password" class="input-field" id="password" placeholder="Password (admin)" required>
                </div>
                <button type="submit" class="btn btn-primary" style="width: 100%;">Login</button>
            </form>
        </div>
    </div>

    <!-- --- APP LAYOUT (Initially Hidden) --- -->
    <div id="app-layout" class="hidden">
        
        <!-- Sidebar -->
        <nav class="sidebar">
            <div class="brand">
                <i class="fas fa-mug-hot"></i> Crisp & Chill
            </div>
            <a class="nav-link active" onclick="router('dashboard')">
                <i class="fas fa-th-large"></i> Dashboard
            </a>
            <a class="nav-link" onclick="router('pos')">
                <i class="fas fa-cash-register"></i> POS / Billing
            </a>
            <a class="nav-link" onclick="router('inventory')">
                <i class="fas fa-boxes"></i> Inventory
            </a>
            <a class="nav-link" onclick="router('sales')">
                <i class="fas fa-history"></i> Sales History
            </a>
            <a class="nav-link logout-btn" onclick="logout()">
                <i class="fas fa-sign-out-alt"></i> Logout
            </a>
        </nav>

        <!-- Main Content -->
        <main class="main-content">
            
            <!-- Dashboard Section -->
            <section id="dashboard-view">
                <div class="page-header">
                    <div class="page-title">Dashboard</div>
                    <div style="font-size: 0.9rem; color: var(--text-light);" id="current-date"></div>
                </div>
                
                <div class="low-stock-alert" id="low-stock-alert">
                    <i class="fas fa-exclamation-triangle"></i> Warning: Some items are running low on stock!
                </div>

                <div class="stats-grid">
                    <div class="stat-card">
                        <span class="stat-label">Today's Sales</span>
                        <span class="stat-value" id="stat-today">₹0</span>
                        <i class="fas fa-chart-line stat-icon"></i>
                    </div>
                    <div class="stat-card">
                        <span class="stat-label">Monthly Sales</span>
                        <span class="stat-value" id="stat-month">₹0</span>
                        <i class="fas fa-calendar-alt stat-icon"></i>
                    </div>
                    <div class="stat-card">
                        <span class="stat-label">Total Revenue</span>
                        <span class="stat-value" id="stat-revenue">₹0</span>
                        <i class="fas fa-wallet stat-icon"></i>
                    </div>
                    <div class="stat-card">
                        <span class="stat-label">Total Bills</span>
                        <span class="stat-value" id="stat-bills">0</span>
                        <i class="fas fa-file-invoice stat-icon"></i>
                    </div>
                </div>

                <h3 style="margin-bottom: 15px; color: var(--dark-pink);">Recent Transactions</h3>
                <div class="data-table-container">
                    <table id="recent-sales-table">
                        <thead>
                            <tr>
                                <th>Invoice ID</th>
                                <th>Customer</th>
                                <th>Amount</th>
                                <th>Time</th>
                            </tr>
                        </thead>
                        <tbody></tbody>
                    </table>
                </div>
            </section>

            <!-- POS Section -->
            <section id="pos-view" class="hidden">
                <div class="pos-container">
                    <div class="product-grid" id="product-grid"></div>
                    
                    <div class="cart-panel">
                        <div class="cart-header">
                            <span>Current Order</span>
                            <i class="fas fa-shopping-basket"></i>
                        </div>
                        <div class="cart-items" id="cart-items">
                            <div style="text-align: center; color: #ccc; margin-top: 50px;">
                                <i class="fas fa-shopping-cart" style="font-size: 2rem;"></i><br>
                                Cart is empty
                            </div>
                        </div>
                        <div class="cart-footer">
                            <div class="summary-row">
                                <span>Subtotal</span>
                                <span id="cart-subtotal">₹0.00</span>
                            </div>
                            <div class="summary-row">
                                <span>Tax (5%)</span>
                                <span id="cart-tax">₹0.00</span>
                            </div>
                            <div class="summary-row summary-total">
                                <span>Total</span>
                                <span id="cart-total">₹0.00</span>
                            </div>
                            <button class="btn btn-primary" style="width: 100%; margin-top: 15px; justify-content: center;" onclick="openCheckoutModal()">
                                Checkout <i class="fas fa-arrow-right"></i>
                            </button>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Inventory Section -->
            <section id="inventory-view" class="hidden">
                <div class="page-header">
                    <div class="page-title">Inventory Management</div>
                    <button class="btn btn-primary" onclick="openProductModal()">
                        <i class="fas fa-plus"></i> Add Product
                    </button>
                </div>
                <div class="data-table-container">
                    <table>
                        <thead>
                            <tr>
                                <th>Image</th>
                                <th>Name</th>
                                <th>Category</th>
                                <th>Price</th>
                                <th>Stock</th>
                                <th>Action</th>
                            </tr>
                        </thead>
                        <tbody id="inventory-table-body"></tbody>
                    </table>
                </div>
            </section>

            <!-- Sales History Section -->
            <section id="sales-view" class="hidden">
                <div class="page-header">
                    <div class="page-title">Sales History</div>
                </div>
                <div class="data-table-container">
                    <table>
                        <thead>
                            <tr>
                                <th>Invoice ID</th>
                                <th>Date & Time</th>
                                <th>Customer</th>
                                <th>Phone</th>
                                <th>Total</th>
                                <th>Method</th>
                                <th>Action</th>
                            </tr>
                        </thead>
                        <tbody id="sales-history-body"></tbody>
                    </table>
                </div>
            </section>

        </main>
    </div>

    <!-- --- MODALS --- -->

    <!-- Checkout Modal -->
    <div id="checkout-modal" class="modal-overlay hidden">
        <div class="modal">
            <div class="modal-header">Customer Details</div>
            <form id="checkout-form" onsubmit="processCheckout(event)">
                <div class="form-group">
                    <label>Customer Name</label>
                    <input type="text" id="cust-name" class="form-control" required placeholder="Enter name">
                </div>
                <div class="form-group">
                    <label>Phone Number</label>
                    <input type="tel" id="cust-phone" class="form-control" required placeholder="Enter phone">
                </div>
                <div class="form-group">
                    <label>Payment Method</label>
                    <select id="pay-method" class="form-control">
                        <option value="Cash">Cash</option>
                        <option value="UPI">UPI</option>
                        <option value="Card">Card</option>
                    </select>
                </div>
                <div style="display: flex; gap: 10px; justify-content: flex-end; margin-top: 20px;">
                    <button type="button" class="btn btn-secondary" onclick="closeModal('checkout-modal')">Cancel</button>
                    <button type="submit" class="btn btn-primary">Generate Bill</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Product Modal -->
    <div id="product-modal" class="modal-overlay hidden">
        <div class="modal">
            <div class="modal-header" id="prod-modal-title">Add Product</div>
            <form id="product-form">
                <input type="hidden" id="prod-id">
                <div class="form-group">
                    <label>Product Name</label>
                    <input type="text" id="prod-name" class="form-control" required>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>Category</label>
                        <select id="prod-cat" class="form-control">
                            <option value="Tea">Tea</option>
                            <option value="Coffee">Coffee</option>
                            <option value="Snacks">Snacks</option>
                            <option value="Drinks">Drinks</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Price (₹)</label>
                        <input type="number" id="prod-price" class="form-control" required min="1">
                    </div>
                </div>
                <div class="form-group">
                    <label>Initial Stock</label>
                    <input type="number" id="prod-stock" class="form-control" required min="0">
                </div>
                
                <!-- FILE UPLOAD -->
                <div class="form-group">
                    <label>Product Image</label>
                    <input type="file" id="prod-img-input" class="form-control" accept="image/*">
                    <div id="preview-container">
                        <span id="preview-placeholder">No Image</span>
                        <img id="preview-img" src="" alt="Preview">
                    </div>
                    <p style="font-size: 0.7rem; color: #888; margin-top: 5px;">*Upload an image from your computer.</p>
                </div>

                <div style="display: flex; gap: 10px; justify-content: flex-end; margin-top: 20px;">
                    <button type="button" class="btn btn-secondary" onclick="closeModal('product-modal')">Cancel</button>
                    <button type="button" class="btn btn-primary" onclick="saveProduct()">Save Product</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Receipt Modal -->
    <div id="receipt-modal" class="modal-overlay hidden">
        <div class="modal" style="background: transparent; box-shadow: none;">
            <div id="receipt-content" class="receipt-preview">
                <div class="receipt-header">
                    <div class="receipt-title">Crisp & Chill</div>
                    <div>Mayor Ramanathan Street,</div>
                    <div>Near Chetpet Bus Stand</div>
                </div>
                <div class="receipt-body">
                    <div class="receipt-item">
                        <span>Invoice #: <span id="bill-inv"></span></span>
                        <span id="bill-date"></span>
                    </div>
                    <div class="receipt-item">
                        <span>Customer: <span id="bill-cust"></span></span>
                        <span id="bill-phone"></span>
                    </div>
                    <div class="receipt-divider"></div>
                    <div id="bill-items"></div>
                    <div class="receipt-divider"></div>
                    <div class="receipt-item">
                        <span>Subtotal</span>
                        <span id="bill-sub"></span>
                    </div>
                    <div class="receipt-item">
                        <span>Tax (5%)</span>
                        <span id="bill-tax"></span>
                    </div>
                    <div class="receipt-total receipt-item">
                        <span>GRAND TOTAL</span>
                        <span id="bill-total"></span>
                    </div>
                    <div class="receipt-item" style="margin-top: 5px;">
                        <span>Paid via: <span id="bill-method"></span></span>
                    </div>
                </div>
                <div class="receipt-footer">
                    Thank You, Visit Again!
                </div>
            </div>
            <div style="text-align: center; margin-top: 20px; display: flex; gap: 10px; justify-content: center;">
                <button class="btn btn-secondary" onclick="closeModal('receipt-modal')">Close</button>
                <button class="btn btn-primary" onclick="printReceipt()">
                    <i class="fas fa-print"></i> Print
                </button>
            </div>
        </div>
    </div>
    <script src="static/script.js"></script>
</body>
</html>